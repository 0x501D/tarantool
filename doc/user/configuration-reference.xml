<!DOCTYPE book [
<!ENTITY % tnt SYSTEM "../tnt.ent">
%tnt;
]>
<chapter xmlns="http://docbook.org/ns/docbook" version="5.0"
         xmlns:xlink="http://www.w3.org/1999/xlink"
         xml:id="configuration-reference">

<title>Configuration reference</title>
<blockquote><para>
  This chapter provides a reference of options which
  can be set in the command line or
  <filename>tarantool.cfg</filename> configuration file.
</para></blockquote>

<para>
Tarantool splits its configuration parameters between command
line options and a configuration file. Command line flags
are provided for the most basic properties only: the rest
must be set in the configuration file.
At runtime, this allows to disambiguate the source of
a configuration setting: it unequivocally comes either from
the command line, or from the configuration file, but never from
both.
</para>

<section>
<title>Command line options</title>
  <para>
    Tarantool follows the <citetitle
    xlink:href="http://www.gnu.org/prep/standards/standards.html#Command_002dLine-Interfaces">GNU
    standard</citetitle> for its command line interface: long
    options start with a double dash (<option>--option</option>),
    their short counterparts use a single one (<option>-o</option>).
    For phrases, both dashes and
    underscores can be used as word separators
    (<option>--cfg-get</option> and <option>--cfg_get</option> both work).
    If an option requires an argument, you can either separate it
    with a space or equals sign (<option>--cfg-get=pid_file</option> and
    <option>--cfg-get pid_file</option> both work).
  </para>
  <itemizedlist>
    <listitem xml:id="help-option">
      <para><option>--help</option>, <option>-h</option></para>
      <para>Print an annotated list of all available options and exit.</para>
    </listitem>

    <listitem xml:id="version-option">
      <para><option>--version</option>, <option>-V</option></para>
      <para>Print product name and version, for example:
        <programlisting><prompt>$ </prompt> ./tarantool_box --version
Tarantool/Box 1.4.0-69-g45551dd
        </programlisting>
        In this example:
        <simplelist>
          <member>
            <quote>Tarantool</quote> is the name
            of the reusable asynchronous networking programming framework.
         </member>
          <member>
            <quote>Box</quote> is the name
            of the storage back-end.
         </member>
          <member>
            The 3-number version follows the standard
            <literal>&lt;major&gt;-&lt;minor&gt;-&lt;patch&gt;</literal>
            scheme, in which <literal>&lt;major&gt;</literal> number
            is changed only rarely, <literal>&lt;minor&gt;</literal>
            is incremented for each new milestone and
            indicates possible incompatible changes,
            and <literal>&lt;patch&gt;</literal> stands for the number of
            bug fix releases made after the start of the
            milestone. The optional commit number and
            commit SHA1 are output for non-released versions
            only, and indicate how much this particular build has diverged
            from the last release.
         </member>
        </simplelist>
      </para>
      <note><para>
        Tarantool uses <link
        xlink:href="http://www.kernel.org/pub/software/scm/git/docs/git-describe.html">git describe</link> to produce its version id, and
        this id can be used at any time to check out the
        corresponding source from our <link
        xlink:href="git://github.com/mailru/tarantool.git">git repository</link>.
      </para></note>
    </listitem>

    <listitem xml:id="config-option">
      <para><option>--config=</option><userinput><filename>/path/to/config.file</filename></userinput>, <option>-c</option></para>
      <para>
        Tarantool does not start without a configuration file. By
        default, the server looks for file named
        <filename>tarantool.cfg</filename> in the current working
        directory. An alternative location can be provided using
        this option.
      </para>
    </listitem>

    <listitem>
      <para><option>--check-config</option></para>
      <para>Check the configuration file for errors. This option is
        normally used on the command line
        before <quote>reload configuration</quote>
        is issued on the administrative port, to ensure that the new
        configuration is valid. When configuration is
        indeed correct, the program produces no output and returns <literal>0</literal>.
        Otherwise, information about discovered error is printed out
        and the program terminates with a non-zero value.
      </para>
    </listitem>

    <listitem>
      <para><option>--cfg-get=</option><userinput>option_name</userinput></para>
      <para>Given option name, print option value. If the
        option does not exist, or the configuration file is
        incorrect, an error is returned. If the option
        is not explicitly specified, its default value is used
        instead. Example:
        <programlisting><prompt>$ </prompt>./tarantool_box --cfg-get=admin_port
33015   </programlisting>
      </para>
    </listitem>
    <listitem>
      <para><option>--init-storage</option></para>
      <para>Initialize the directory, specified in <emphasis>vardir</emphasis>
      configuration option by creating an empty snapshot file in
      it. If <filename>vardir</filename> doesn't contain at
      least one snapshot, the server does not start. There is no
      <quote>magic</quote> with automatic initialization of
      <filename>vardir</filename> on boot to make
      potential system errors more noticeable. For example, if the
      operating system reboots and fails to mount the partition on
      which <filename>vardir</filename> is expected to reside, the
      <filename>rc.d</filename> or <command>service</command> script
      responsible for server restart will also fail, thanks to this
      option.
      </para>
    </listitem>

    <listitem>
      <para><option>--cat</option> <userinput>snapshot.file</userinput></para>
      <para>Print the snapshot file, pointed to by the argument,
      in a human-readable form. For each log record, log sequence
      number, time of entry, operation type and arguments are
      printed out. Example:
        <programlisting><prompt>$ </prompt>./tarantool_box --cat 00000000000000000002.xlog
lsn:2 tm:1301572243.430 t:65534 127.0.0.1:52728 INSERT n:0&lt;"1:\x01\x00\x00\x00"&gt;
lsn:3 tm:1301572287.509 t:65534 127.0.0.1:52728 INSERT n:0&lt;"1:\x01\x00\x00\x00", "hello"&gt;
lsn:4 tm:1301572313.691 t:65534 127.0.0.1:52728 UPDATE_FIELDS n:0flags:00000000 &lt;"1:\x01\x00\x00\x00"&gt; [field_no:1 op:set &lt;"world"&gt;]</programlisting>
      </para>
    </listitem>
  </itemizedlist>
  <para>
    The only two options which have effect on a running server are:
  </para>
  <itemizedlist>
    <listitem>
      <para><option>--verbose</option>, <option>-v</option></para>
      <para>Increase verbosity level in log messages. This option
      currently has no effect.</para>
    </listitem>

    <listitem>
      <para><option>--background</option>, <option>-b</option></para>
      <para>Detach from the controlling terminal and run in
        background.
        <caution><para>Tarantool uses
        <filename>stdout</filename> and
        <filename>stderr</filename> for
        debug and error log output. When starting the server with
        option <option>--background</option>, make sure to
        either redirect its standard out and standard error
        streams, or provide <emphasis>logger</emphasis> option
        in the configuration file, since otherwise all logging
        information will be lost</para></caution>
      </para>
    </listitem>
  </itemizedlist>
</section>

<section>
<title>The option file</title>
  <para>
    All advanced configuration parameters must be specified in a
    configuration file, which is required for server start. If no path to
    the configuration file is specified on the command line (see
    <option xlink:href="#config-option"
    xlink:title="--config=...">--config</option>),
    the server looks for a file named <filename>tarantool.cfg</filename>
    in the current working directory.
  </para>
  <para>
    To facilitate centralized and automated configuration
    management, runtime configuration modifications are supported
    solely through <emphasis role="tntadmin"
    xlink:href="tarantool-user-guide#reload-configuration"
    xlink:title="reload configuration"
    xlink:role="http://docbook.org/xlink/role/olink">reload
    configuration</emphasis> administrative statement. Thus, the
    procedure to change Tarantool configuration at runtime is to
    edit the configuration file.  This ensures that, should the
    server get killed or restart, no unexpected changes to
    configuration can occur.
  </para>
  <para>
    Not all configuration file settings are changeable at runtime:
    such settings will be highlighted in this reference.
  </para>
  <para>
    Tarantool maintains a set of all allowed configuration
    parameters in two template files, which are easy to maintain
    and extend:
    <filename xlink:href="https://github.com/mailru/tarantool/blob/master/cfg/core_cfg.cfg_tmpl">cfg/core_cfg.cfg_tmpl</filename>,
    <filename xlink:href="https://github.com/mailru/tarantool/blob/master/mod/box/box_cfg.cfg_tmpl">mod/box/box_cfg.cfg_tmpl</filename>.
    These files can always be used as a reference for any
    parameter in this manual.
  </para>

  <para>In addition, two working examples can be found in the source tree:
    <filename xlink:href="https://github.com/mailru/tarantool/blob/master/test/box/tarantool.cfg">test/box/tarantool.cfg</filename>,
    <filename xlink:href="https://github.com/mailru/tarantool/blob/master/test/box_big/tarantool.cfg">test/box_big/tarantool.cfg</filename>.
  </para>
  <table frame='all'>
    <title>Basic parameters</title>
    <tgroup cols='6' colsep='1' rowsep='1'>

      <thead>
        <row>
          <entry>Name</entry>
          <entry>Type</entry>
          <entry>Default</entry>
          <entry>Required?</entry>
          <entry>Dynamic?</entry>
          <entry>Description</entry>
        </row>
      </thead>

      <tbody>

        <row>
          <entry>username</entry>
          <entry>string</entry>
          <entry>""</entry>
          <entry>no</entry>
          <entry>no</entry>
          <entry>UNIX user name to switch to after start.</entry>
        </row>

        <row>
          <entry>work_dir</entry>
          <entry>string</entry>
          <entry>""</entry>
          <entry>no</entry>
          <entry>no</entry>
          <entry>A directory to switch to with chdir(2) after
          start. Can be relative to the starting directory.
          If not specified, the current working directory
          of the server is the same as starting
          directory.</entry>
        </row>

        <row>
          <entry>wal_dir</entry>
          <entry>string</entry>
          <entry>""</entry>
          <entry>no</entry>
          <entry>no</entry>
          <entry>A directory to store the write ahead log files
          (WAL) in. Can be relative to work_dir. You may choose
          to separate your snapshots and logs and store them
          on separate disks. This is how this parameter is most
          commonly used. If not specified, defaults to work_dir.</entry>
        </row>

        <row>
          <entry>snap_dir</entry>
          <entry>string</entry>
          <entry>""</entry>
          <entry>no</entry>
          <entry>no</entry>
          <entry>A directory to store snapshots in. Can be
          relative to work_dir. If not specified, defaults to
          work_dir. See also wal_dir.</entry>
        </row>
<!--
        <row>
          <entry>coredump</entry><entry>0 or 1</entry><entry>0</entry>
          <entry>Deprecated. Save core on abort/assert? You may
          turn off the coredump off when using ulimit</entry>
        </row>
-->
        <row>
          <entry>primary_port</entry>
          <entry>integer</entry>
          <entry><emphasis role="strong">none</emphasis></entry>
          <entry><emphasis role="strong">yes</emphasis></entry>
          <entry>no</entry>
          <entry>The read/write data port.
          Has no default value, so <emphasis
          role="strong">must be specified</emphasis>
          in the configuration file. Normally set to 33013.
          Note: a replica also binds to this port, accepts
          connections, but these connections can only serve
          reads until the replica becomes a master.</entry>
        </row>

        <row>
          <entry>secondary_port</entry>
          <entry>integer</entry>
          <entry><emphasis role="strong">none</emphasis></entry>
          <entry><emphasis role="strong">yes</emphasis></entry>
          <entry>no</entry>
          <entry>Additional, read-only port. Normally set to
          33014.</entry>
        </row>

        <row>
          <entry>admin_port</entry>
          <entry>integer</entry>
          <entry><emphasis role="strong">none</emphasis></entry>
          <entry><emphasis role="strong">yes</emphasis></entry>
          <entry>no</entry>
          <entry>The TCP port to listen on for administrative
          connections. Has no default value, so must be specified.
          Normally set to 33015.</entry>
        </row>


        <row>
          <entry>log_level</entry>
          <entry>integer</entry>
          <entry>4</entry>
          <entry>no</entry>
          <entry><emphasis role="strong">yes</emphasis></entry>
          <entry>How verbose the logging is. There are 5 log
            verbosity classes: 1 -- ERROR, 2 -- CRITICAL, 3 --
            WARNING, 4 -- INFO, 5 -- DEBUG. By setting log_level,
            you can enable logging of all classes below or equal
            to the given level. Tarantool prints its logs to the
            standard error stream by default, but this can be
            changed with "logger" configuration parameter.
          </entry>
        </row>

        <row>
          <entry>logger</entry>
          <entry>string</entry>
          <entry>""</entry>
          <entry>no</entry>
          <entry>no</entry>
          <entry>By default, the log is sent to the standard
          output. If this option is specified, </entry>
        </row>
<!--

pid_file="tarantool.pid", ro

# custom proc title is appended after normal
custom_proc_title=NULL, ro

# logger command will be executed via /bin/sh -c {}
# example: 'exec cronolog /var/log/taranul/%Y-%m/%Y-%m-%d/tarantool.log'
# example: 'exec extra/logger.pl /var/log/taranul/tarantool.log'
# when logger is not configured all logging going to STDERR
logger=NULL, ro

# make logging nonblocking, this potentially can loss some logging data
logger_nonblock=1, ro


# warn about requests which take longer to process
too_long_threshold=0.5

Network-related  settings
******************

Storage parameters.
******************

## BOX


# panic if where is error reading snap or wal
# be default panic any snapshot reading error  and ignore errors then reading wals
panic_on_snap_error=1, ro
panic_on_wal_error=0, ro

# Size of slab arena in GiBs
slab_alloc_arena=1.0, ro
# Size of minimal allocation unit
slab_alloc_minimal=64, ro
# Growth factor, each subsecuent unit size is factor * prev unit size
slab_alloc_factor=2.0, ro

namespace = [
  {
    enabled = -1, required
    cardinality = -1
    estimated_rows = 0
    index = [
      {
        type = "", required
        unique = -1, required
        key_field = [
          {
            fieldno = -1, required
            type = "", required
          }, ro,  required
        ], required
      }, ro, required
    ], required
  }, ro
], ro, required
-->

      </tbody>

    </tgroup>
  </table>

<!--
  <table frame='all'>
    <title>Networking and file I/O</title>
-->
<!--
# network io readahead
readahead=16320
# size of listen backlog
backlog=1024, ro

# delay between loop iterations
io_collect_interval=0.0, ro
# do not write snapshot faster then snap_io_rate_limit MBytes/sec
snap_io_rate_limit=0.0, ro

# Write no more rows in WAL
rows_per_wal=500000, ro

# fsync WAL delay, only issue fsync if last fsync was wal_fsync_delay seconds ago
# WARNING: actually, several last requsts may stall for much longer
wal_fsync_delay=0, ro

# size of WAL writer requests buffer
wal_writer_inbox_size=128, ro
-->
<!--
  </table>

  <table>
    <title>Replication</title>
-->
<!--
# Remote hot standby (if enabled server will run in hot standby mode
# continuously fetching WAL records from wal_feeder_ipaddr:wal_feeder_port
remote_hot_standby=0, ro
wal_feeder_ipaddr=NULL, ro
wal_feeder_port=0, ro

-->
<!--
  </table>

  <table>
    <title>Memcached support</title>
-->
<!--
# Memcached emulation is enabled if memcached == 1
memcached=0, ro
# namespace used for memcached emulation
memcached_namespace=23, ro
# maximum rows to consider per expire loop iteration
memcached_expire_per_loop=1024
# tarantool will try iterate all rows within this time
memcached_expire_full_sweep=3600
  </table>
-->

</section>
</chapter>

<!--
vim: tw=66 syntax=docbk
vim: spell spelllang=en_us
-->
