# encoding: tarantool
#
import os
import shutil


push_lua_path = os.path.join(vardir, "part_index.lua")
shutil.copy("box_big/part_index.lua", push_lua_path)

exec admin "lua dofile('part_index.lua')"
shutil.rmtree(push_lua_path, True)


exec admin "lua box.insert(18, 1, 2, 3)"
exec admin "lua box.insert(18, 1, 2, 3)"
exec admin "lua box.select(18, 0, 1)"
exec admin "lua box.delete(18, 1)"

# unknown_function (HASH)
exec admin "lua box.insert(19, 1, 2, 3)"
exec admin "lua box.insert(19, 1, 2, 3)"
exec admin "lua box.select(19, 0, 1)"

# unknown_function (TREE)
exec admin "lua box.insert(20, 1, 2, 3)"
exec admin "lua box.insert(20, 1, 2, 3)"
exec admin "lua box.select(20, 0, 1)"

# ok_trigger
exec admin "lua box.insert(21, 1, 2, 3)"
exec admin "lua box.insert(21, 1, 2, 3)"
exec admin "lua box.select(21, 0, 1)"
exec admin "lua box.select(21, 1, 1)"
exec admin "lua box.delete(21, 1)"

# false_trigger
exec admin "lua box.insert(22, 1, 2, 3)"
exec admin "lua box.insert(22, 1, 2, 3)"
exec admin "lua box.select(22, 0, 1)"
exec admin "lua box.select(22, 1, 1)"
exec admin "lua cleanup_space(22)"

# less_than_10_trigger
exec admin "lua box.insert(23, 1, 2, 3)"
exec admin "lua box.select(23, 0, 1)"
exec admin "lua box.select(23, 1, 1)"

exec admin "lua box.insert(23, 2, 3, 4)"
exec admin "lua box.select(23, 0, 2)"
exec admin "lua box.select(23, 1, 2)"

exec admin "lua box.insert(23, 3, 11, 12)"
exec admin "lua box.select(23, 0, 3)"
exec admin "lua box.select(23, 1, 3)"
exec admin "lua box.space[23].index[1]:len()"
exec admin "lua box.space[23].index[0]:len()"

exec admin "lua cleanup_space(23)"

# less_than_10_trigger (TREE NU)
exec admin "lua box.insert(24, 1, 2, 3)"
exec admin "lua box.select(24, 0, 1)"
exec admin "lua box.select(24, 1, 2)"

exec admin "lua box.insert(24, 2, 2, 3)"
exec admin "lua box.select(24, 0, 2)"
exec admin "lua box.select(24, 1, 2)"

exec admin "lua box.insert(24, 3, 3, 4)"
exec admin "lua box.select(24, 0, 3)"
exec admin "lua box.select(24, 1, 3)"

exec admin "lua box.insert(24, 4, 13, 4)"
exec admin "lua box.select(24, 0, 4)"
exec admin "lua box.select(24, 1, 13)"

exec admin "lua box.space[24].index[0]:len() - box.space[24].index[1]:len()"

exec admin "lua box.replace(24, 4, 9, 4)"
exec admin "lua box.select(24, 0, 4)"
exec admin "lua box.select(24, 1, 9)"

exec admin "lua box.space[24].index[0]:len() == box.space[24].index[1]:len()"

exec admin "lua cleanup_space(24)"
