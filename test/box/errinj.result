box.insert(box.schema.SPACE_ID, 0, 0, 'tweedledum')
---
- [0, 0, 'tweedledum']
...
box.insert(box.schema.INDEX_ID, 0, 0, 'primary', 'hash', 1, 1, 0, 'num')
---
- [0, 0, 'primary', 1752392040, 1, 1, 0, 'num']
...
box.errinj.info()
---
- ERRINJ_INDEX_ALLOC:
    state: false
  ERRINJ_WAL_IO:
    state: false
  ERRINJ_WAL_ROTATE:
    state: false
  ERRINJ_TESTING:
    state: false
...
box.errinj.set("some-injection", true)
---
- 'error: can''t find error injection ''some-injection'''
...
box.errinj.set("some-injection") -- check error
---
- 'error: can''t find error injection ''some-injection'''
...
box.space[0]:select(0,222444)
---
...
box.errinj.set("ERRINJ_TESTING", true)
---
- ok
...
box.space[0]:select(0,222444)
---
- error: Error injection 'ERRINJ_TESTING'
...
box.errinj.set("ERRINJ_TESTING", false)
---
- ok
...
-- Check how well we handle a failed log write
box.errinj.set("ERRINJ_WAL_IO", true)
---
- ok
...
box.space[0]:insert(1)
---
- error: Failed to write to disk
...
box.space[0]:select(0,1)
---
...
box.errinj.set("ERRINJ_WAL_IO", false)
---
- ok
...
box.space[0]:insert(1)
---
- [1]
...
box.errinj.set("ERRINJ_WAL_IO", true)
---
- ok
...
box.space[0]:update(1, '=p', 0, 2)
---
- error: Failed to write to disk
...
box.space[0]:select(0,1)
---
- [1]
...
box.space[0]:select(0,2)
---
...
box.errinj.set("ERRINJ_WAL_IO", false)
---
- ok
...
box.space[0]:truncate()
---
...
-- Check a failed log rotation
box.errinj.set("ERRINJ_WAL_ROTATE", true)
---
- ok
...
box.space[0]:insert(1)
---
- error: Failed to write to disk
...
box.space[0]:select(0,1)
---
...
box.errinj.set("ERRINJ_WAL_ROTATE", false)
---
- ok
...
box.space[0]:insert(1)
---
- [1]
...
box.errinj.set("ERRINJ_WAL_ROTATE", true)
---
- ok
...
box.space[0]:update(1, '=p', 0, 2)
---
- error: Failed to write to disk
...
box.space[0]:select(0,1)
---
- [1]
...
box.space[0]:select(0,2)
---
...
box.errinj.set("ERRINJ_WAL_ROTATE", false)
---
- ok
...
box.space[0]:update(1, '=p', 0, 2)
---
- [2]
...
box.space[0]:select(0,1)
---
...
box.space[0]:select(0,2)
---
- [2]
...
box.errinj.set("ERRINJ_WAL_ROTATE", true)
---
- ok
...
box.space[0]:truncate()
---
- error: Failed to write to disk
...
box.errinj.set("ERRINJ_WAL_ROTATE", false)
---
- ok
...
box.space[0]:truncate()
---
...
box.space[0]:drop()
---
...
-- vim: tabstop=4 expandtab shiftwidth=4 softtabstop=4 syntax=lua
